"0","ensemble_recommender <- function(customer, context_similarities, no_context_similarities, product_similarities, wide_customer_products_matrix, predicted_ratings){"
"0","  "
"0","  # Convert to character"
"0","  customer <- ifelse(is.character(customer), customer, as.character(customer))"
"0","  "
"0","  # Context containing similarity"
"0","  rank_1 <- customer_based_recommendations(customer,"
"0","                                      context_similarities,"
"0","                                      wide_customer_products_matrix) %>%"
"0","    mutate(p_rank = rank(-score)) %>%"
"0","    select(product, p_rank)"
"0","  "
"0","  # User bought similarity only"
"0","  rank_2 <- customer_based_recommendations(customer,"
"0","                                      no_context_similarities,"
"0","                                      wide_customer_products_matrix) %>%"
"0","    mutate(p_rank = rank(-score)) %>%"
"0","    select(product, p_rank)"
"0","  "
"0","  # Item similarity"
"0","  rank_3 <- product_based_recommendations(customer,"
"0","                                     product_similarities,"
"0","                                     t(wide_customer_products_matrix)) %>%"
"0","    mutate(p_rank = rank(-score)) %>%"
"0","    select(product, p_rank)"
"0","  "
"0","  # Matrix factorization"
"0","  rank_4 <- data.frame(score = predicted_ratings[customer,]) %>%"
"0","    rownames_to_column(""product"") %>%"
"0","    mutate(p_rank = rank(-score)) %>%"
"0","    select(product, p_rank)"
"0","  "
"0","  # Combination of methods"
"0","  customer_recs <- inner_join(inner_join(inner_join(rank_1, rank_2, by = ""product""), rank_3, by = ""product""), rank_4, by = ""product"") %>%"
"0","    mutate(overall = p_rank.x + p_rank.y + p_rank.x.x + p_rank.y.y) %>%"
"0","    select(product, overall) %>%"
"0","    mutate(p_rank = rank(overall)) %>%"
"0","    select(product, p_rank) %>%"
"0","    arrange(p_rank)"
"0","  "
"0","  return(customer_recs)"
"0","}"
"0","suppressWarnings(ensemble_recommender(""39263"","
"0","                     context_similarities = cs_2_indexedBy1,"
"0","                     no_context_similarities = customer_similarities1,"
"0","                     product_similarities = product_similarities1,"
"0","                     wide_customer_products_matrix = customer_products_bought_wide,"
"0","                     predicted_ratings = mf1_predicted))"
